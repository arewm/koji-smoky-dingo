
FROM centos:8

RUN mkdir -p /src

RUN \
    dnf install -qy epel-release && \
    dnf install -qy \
        dnf-plugins-core make rpm-build which \
        python3-nose python3-pip && \
    pip3 install -q mock

COPY Makefile setup.py kojismokydingo-*.tar.gz /src/

RUN \
    cd /src && make srpm && \
    dnf builddep -qy /root/rpmbuild/SRPMS/kojismokydingo-*.src.rpm && \
    rpmbuild --rebuild /root/rpmbuild/SRPMS/kojismokydingo-*.src.rpm && \
    dnf install -qy /root/rpmbuild/RPMS/noarch/*kojismokydingo*.rpm && \
    cd / && rm -rf /src

# The end.
