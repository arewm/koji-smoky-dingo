
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="English">
  <head>
    <meta charset="utf-8" />
    <title>kojismokydingo &#8212; kojismokydingo 0.9.7 documentation</title>
    <link rel="stylesheet" href="../../_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head><body>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">kojismokydingo 0.9.7 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for kojismokydingo</h1><div class="highlight"><pre>
<span></span><span class="c1"># This library is free software; you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation; either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This library is distributed in the hope that it will be useful, but</span>
<span class="c1"># WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<span class="c1"># General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this library; if not, see &lt;http://www.gnu.org/licenses/&gt;.</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Koji Smoky Dingo - Client utilities for working with the Koji</span>
<span class="sd">build system</span>

<span class="sd">:author: Christopher O&#39;Brien &lt;obriencj@gmail.com&gt;</span>
<span class="sd">:license: GPL v3</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">koji</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">ClientSession</span><span class="p">,</span> <span class="n">Fault</span><span class="p">,</span> <span class="n">GenericError</span><span class="p">,</span> <span class="n">ParameterError</span><span class="p">,</span>
    <span class="n">convertFault</span><span class="p">,</span> <span class="n">read_config</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">koji_cli.lib</span> <span class="k">import</span> <span class="n">activate_session</span><span class="p">,</span> <span class="n">ensure_connection</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="k">import</span> <span class="nb">map</span><span class="p">,</span> <span class="nb">zip</span>

<span class="kn">from</span> <span class="nn">.common</span> <span class="k">import</span> <span class="n">chunkseq</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;AnonClientSession&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BadDingo&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FeatureUnavailable&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ManagedClientSession&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NoSuchArchive&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NoSuchBuild&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NoSuchChannel&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NoSuchContentGenerator&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NoSuchPermission&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NoSuchRPM&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NoSuchTag&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NoSuchTarget&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NoSuchTask&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NoSuchUser&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NotPermitted&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ProfileClientSession&quot;</span><span class="p">,</span>

    <span class="s2">&quot;as_archiveinfo&quot;</span><span class="p">,</span>
    <span class="s2">&quot;as_buildinfo&quot;</span><span class="p">,</span>
    <span class="s2">&quot;as_hostinfo&quot;</span><span class="p">,</span>
    <span class="s2">&quot;as_rpminfo&quot;</span><span class="p">,</span>
    <span class="s2">&quot;as_taginfo&quot;</span><span class="p">,</span>
    <span class="s2">&quot;as_targetinfo&quot;</span><span class="p">,</span>
    <span class="s2">&quot;as_taskinfo&quot;</span><span class="p">,</span>
    <span class="s2">&quot;as_userinfo&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bulk_load&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bulk_load_build_archives&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bulk_load_build_rpms&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bulk_load_builds&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bulk_load_buildroot_archives&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bulk_load_buildroot_rpms&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bulk_load_buildroots&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bulk_load_rpm_sigs&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bulk_load_tags&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bulk_load_tasks&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bulk_load_users&quot;</span><span class="p">,</span>
    <span class="s2">&quot;hub_version&quot;</span><span class="p">,</span>
    <span class="s2">&quot;iter_bulk_load&quot;</span><span class="p">,</span>
    <span class="s2">&quot;version_check&quot;</span><span class="p">,</span>
    <span class="s2">&quot;version_require&quot;</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="ManagedClientSession"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.ManagedClientSession">[docs]</a><span class="k">class</span> <span class="nc">ManagedClientSession</span><span class="p">(</span><span class="n">ClientSession</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A `koji.ClientSession` that can be used as via the ``with``</span>
<span class="sd">    keyword to provide a managed session that will handle</span>
<span class="sd">    authenticated login and logout.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">activate_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">opts</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">_exc_val</span><span class="p">,</span> <span class="n">_exc_tb</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rsession</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rsession</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rsession</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">exc_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="ProfileClientSession"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.ProfileClientSession">[docs]</a><span class="k">class</span> <span class="nc">ProfileClientSession</span><span class="p">(</span><span class="n">ManagedClientSession</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A `koji.ClientSession` which loads profile config information and</span>
<span class="sd">    which can be used via tha ``with`` keyword.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="s2">&quot;koji&quot;</span><span class="p">):</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="n">read_config</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span>
        <span class="n">server</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ProfileClientSession</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="n">conf</span><span class="p">)</span></div>


<div class="viewcode-block" id="AnonClientSession"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.AnonClientSession">[docs]</a><span class="k">class</span> <span class="nc">AnonClientSession</span><span class="p">(</span><span class="n">ProfileClientSession</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A `koji.ClientSession` which loads profile config information and</span>
<span class="sd">    which can be used via the ``with`` keyword.</span>

<span class="sd">    Suitable for working with anonymous commands which do not require</span>
<span class="sd">    authentication. Does not authenticate, and will only connect</span>
<span class="sd">    lazily.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># we could always set up a connection ahead of time,</span>
        <span class="c1"># but... the connection will be created when we make our first</span>
        <span class="c1"># call, so let&#39;s be lazy instead.</span>

        <span class="c1"># ensure_connection(self)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="BadDingo"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.BadDingo">[docs]</a><span class="k">class</span> <span class="nc">BadDingo</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generalized base class for exceptions raised from kojismokydingo.</span>
<span class="sd">    This class and its subclasses are used to combine a fixed</span>
<span class="sd">    complaint string with some specific information. This is a</span>
<span class="sd">    convenience primarily for the CLI, but can also be used to track</span>
<span class="sd">    more detailed situations where a requested data type wasn&#39;t</span>
<span class="sd">    present on the koji hub, rather than just working with</span>
<span class="sd">    `koji.GenericError`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">complaint</span> <span class="o">=</span> <span class="s2">&quot;Something bad happened&quot;</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">orig</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">BadDingo</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
        <span class="k">return</span> <span class="s2">&quot;: &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">complaint</span><span class="p">,</span> <span class="n">orig</span><span class="p">])</span></div>


<div class="viewcode-block" id="NoSuchBuild"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.NoSuchBuild">[docs]</a><span class="k">class</span> <span class="nc">NoSuchBuild</span><span class="p">(</span><span class="n">BadDingo</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A build was not found</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">complaint</span> <span class="o">=</span> <span class="s2">&quot;No such build&quot;</span></div>


<span class="k">class</span> <span class="nc">NoSuchHost</span><span class="p">(</span><span class="n">BadDingo</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A host was not found</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">complaint</span> <span class="o">=</span> <span class="s2">&quot;No such host&quot;</span>


<div class="viewcode-block" id="NoSuchChannel"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.NoSuchChannel">[docs]</a><span class="k">class</span> <span class="nc">NoSuchChannel</span><span class="p">(</span><span class="n">BadDingo</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A channel was not found</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">complaint</span> <span class="o">=</span> <span class="s2">&quot;No such builder channel&quot;</span></div>


<div class="viewcode-block" id="NoSuchContentGenerator"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.NoSuchContentGenerator">[docs]</a><span class="k">class</span> <span class="nc">NoSuchContentGenerator</span><span class="p">(</span><span class="n">BadDingo</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A content generator was not found</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">complaint</span> <span class="o">=</span> <span class="s2">&quot;No such content generator&quot;</span></div>


<div class="viewcode-block" id="NoSuchTag"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.NoSuchTag">[docs]</a><span class="k">class</span> <span class="nc">NoSuchTag</span><span class="p">(</span><span class="n">BadDingo</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A tag was not found</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">complaint</span> <span class="o">=</span> <span class="s2">&quot;No such tag&quot;</span></div>


<div class="viewcode-block" id="NoSuchTarget"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.NoSuchTarget">[docs]</a><span class="k">class</span> <span class="nc">NoSuchTarget</span><span class="p">(</span><span class="n">BadDingo</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A target was not found</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">complaint</span> <span class="o">=</span> <span class="s2">&quot;No such target&quot;</span></div>


<div class="viewcode-block" id="NoSuchTask"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.NoSuchTask">[docs]</a><span class="k">class</span> <span class="nc">NoSuchTask</span><span class="p">(</span><span class="n">BadDingo</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A task was not found</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">complaint</span> <span class="o">=</span> <span class="s2">&quot;No such task&quot;</span></div>


<div class="viewcode-block" id="NoSuchUser"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.NoSuchUser">[docs]</a><span class="k">class</span> <span class="nc">NoSuchUser</span><span class="p">(</span><span class="n">BadDingo</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A user was not found</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">complaint</span> <span class="o">=</span> <span class="s2">&quot;No such user&quot;</span></div>


<div class="viewcode-block" id="NoSuchPermission"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.NoSuchPermission">[docs]</a><span class="k">class</span> <span class="nc">NoSuchPermission</span><span class="p">(</span><span class="n">BadDingo</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A permission was not found</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">complaint</span> <span class="o">=</span> <span class="s2">&quot;No such permission&quot;</span></div>


<div class="viewcode-block" id="NoSuchArchive"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.NoSuchArchive">[docs]</a><span class="k">class</span> <span class="nc">NoSuchArchive</span><span class="p">(</span><span class="n">BadDingo</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An archive was not found</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">complaint</span> <span class="o">=</span> <span class="s2">&quot;No such archive&quot;</span></div>


<div class="viewcode-block" id="NoSuchRPM"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.NoSuchRPM">[docs]</a><span class="k">class</span> <span class="nc">NoSuchRPM</span><span class="p">(</span><span class="n">BadDingo</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An RPM was not found</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">complaint</span> <span class="o">=</span> <span class="s2">&quot;No such RPM&quot;</span></div>


<div class="viewcode-block" id="NotPermitted"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.NotPermitted">[docs]</a><span class="k">class</span> <span class="nc">NotPermitted</span><span class="p">(</span><span class="n">BadDingo</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A required permission was not associated with the currently logged</span>
<span class="sd">    in user account.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">complaint</span> <span class="o">=</span> <span class="s2">&quot;Insufficient permissions&quot;</span></div>


<div class="viewcode-block" id="FeatureUnavailable"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.FeatureUnavailable">[docs]</a><span class="k">class</span> <span class="nc">FeatureUnavailable</span><span class="p">(</span><span class="n">BadDingo</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A given feature isn&#39;t available due to the version on the koji hub</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">complaint</span> <span class="o">=</span> <span class="s2">&quot;The koji hub version doesn&#39;t support this feature&quot;</span></div>


<div class="viewcode-block" id="iter_bulk_load"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.iter_bulk_load">[docs]</a><span class="k">def</span> <span class="nf">iter_bulk_load</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">loadfn</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generic bulk loading generator. Invokes the given loadfn on each</span>
<span class="sd">    key in keys using chunking multicalls limited to the specified</span>
<span class="sd">    size.</span>

<span class="sd">    Yields (key, result) pairs in order.</span>

<span class="sd">    If err is True (default) then any faults will raise an exception.</span>
<span class="sd">    If err is False, then a None will be substituted as the result for</span>
<span class="sd">    the failing key.</span>

<span class="sd">    :param session: The koji session</span>

<span class="sd">    :type session: `koji.ClientSession`</span>

<span class="sd">    :param loadfn: The loading function, to be invoked in a multicall</span>
<span class="sd">      arrangement. Will be called once with each given key from keys</span>

<span class="sd">    :type loadfn: Callable[[object], object]</span>

<span class="sd">    :param keys: The sequence of keys to be used to invoke loadfn.</span>

<span class="sd">    :type keys: list[object]</span>

<span class="sd">    :param err: Whether to raise any underlying fault returns as</span>
<span class="sd">      exceptions. Default, True</span>

<span class="sd">    :type err: bool, optional</span>

<span class="sd">    :param size: How many calls to loadfn to chunk up for each</span>
<span class="sd">      multicall. Default, 100</span>

<span class="sd">    :type size: int, optional</span>

<span class="sd">    :raises koji.GenericError: if err is True and an issue</span>
<span class="sd">      occurrs while invoking the loadfn</span>

<span class="sd">    :rtype: Generator[tuple[object, object]]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">key_chunk</span> <span class="ow">in</span> <span class="n">chunkseq</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="n">session</span><span class="o">.</span><span class="n">multicall</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">key_chunk</span><span class="p">:</span>
            <span class="n">loadfn</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">key_chunk</span><span class="p">,</span> <span class="n">session</span><span class="o">.</span><span class="n">multiCall</span><span class="p">(</span><span class="n">strict</span><span class="o">=</span><span class="n">err</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">info</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;faultCode&quot;</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">err</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">convertFault</span><span class="p">(</span><span class="n">Fault</span><span class="p">(</span><span class="o">**</span><span class="n">info</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="n">key</span><span class="p">,</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">key</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">key</span><span class="p">,</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="bulk_load"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.bulk_load">[docs]</a><span class="k">def</span> <span class="nf">bulk_load</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">loadfn</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generic bulk loading function. Invokes the given `loadfn` on each</span>
<span class="sd">    key in `keys` using chunking multicalls limited to the specified</span>
<span class="sd">    size.</span>

<span class="sd">    Returns an `OrderedDict` associating the individual keys with the</span>
<span class="sd">    returned value of loadfn. If `results` is specified, it must</span>
<span class="sd">    support dict-like assignment via an update method, and will be</span>
<span class="sd">    used in place of a newly allocated `OrderedDict` to store and</span>
<span class="sd">    return the results.</span>

<span class="sd">    :param session: The koji session</span>

<span class="sd">    :type session: `koji.ClientSession`</span>

<span class="sd">    :param loadfn: The loading function, to be invoked in a multicall</span>
<span class="sd">      arrangement. Will be called once with each given key from `keys`</span>

<span class="sd">    :type loadfn: Callable[[object], object]</span>

<span class="sd">    :param keys: The sequence of keys to be used to invoke `loadfn`.</span>
<span class="sd">      These keys need to be individually hashable, or the `results`</span>
<span class="sd">      value needs to be specified with an instance that accepts</span>
<span class="sd">      assignmnet using these values as the key.</span>

<span class="sd">    :type keys: list[object]</span>

<span class="sd">    :param err: Whether to raise any underlying fault returns as</span>
<span class="sd">      exceptions. Default, True</span>

<span class="sd">    :type err: bool, optional</span>

<span class="sd">    :param size: How many calls to `loadfn` to chunk up for each</span>
<span class="sd">      multicall. Default, 100</span>

<span class="sd">    :type size: int, optional</span>

<span class="sd">    :param results: storage for `loadfn` results. If specified, must</span>
<span class="sd">      support item assignment (like a dict) via an update method, and</span>
<span class="sd">      it will be populated and then used as the return value for this</span>
<span class="sd">      function. Default, a new `OrderedDict` will be allocated.</span>

<span class="sd">    :type results: dict, optional</span>

<span class="sd">    :raises koji.GenericError: if `err` is `True` and an issue</span>
<span class="sd">      occurrs while invoking the `loadfn`</span>

<span class="sd">    :rtype: dict[object, object]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span> <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">results</span>
    <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">iter_bulk_load</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">loadfn</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="bulk_load_builds"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.bulk_load_builds">[docs]</a><span class="k">def</span> <span class="nf">bulk_load_builds</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">nvrs</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load many buildinfo dicts from a koji client session and a</span>
<span class="sd">    sequence of NVRs.</span>

<span class="sd">    Returns an OrderedDict associating the individual NVRs with their</span>
<span class="sd">    resulting buildinfo.</span>

<span class="sd">    If err is True (default) then any missing build info will raise a</span>
<span class="sd">    NoSuchBuild exception. If err is False, then a None will be</span>
<span class="sd">    substituted into the ordered dict for the result.</span>

<span class="sd">    If results is non-None, it must support dict assignment, and will</span>
<span class="sd">    be used in place of a newly allocated OrderedDict to store and</span>
<span class="sd">    return the results.</span>

<span class="sd">    :param nvrs: Sequence of build NVRs or build IDs to load</span>

<span class="sd">    :type nvrs: Iterator[str] or Iterator[int]</span>

<span class="sd">    :param err: Raise an exception if an NVR fails to load. Default,</span>
<span class="sd">      True.</span>

<span class="sd">    :type err: bool, optional</span>

<span class="sd">    :param size: Count of NVRs to load in a single multicall. Default,</span>
<span class="sd">      100</span>

<span class="sd">    :type size: int, optional</span>

<span class="sd">    :param results: mapping to store the results in. Default, produce</span>
<span class="sd">      a new OrderedDict</span>

<span class="sd">    :type results: Mapping, optional</span>

<span class="sd">    :rtype: Mapping</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span> <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">results</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">iter_bulk_load</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">session</span><span class="o">.</span><span class="n">getBuild</span><span class="p">,</span> <span class="n">nvrs</span><span class="p">,</span>
                                    <span class="kc">False</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">err</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">info</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoSuchBuild</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span>

    <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="bulk_load_tasks"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.bulk_load_tasks">[docs]</a><span class="k">def</span> <span class="nf">bulk_load_tasks</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">task_ids</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load many taskinfo dicts from a koji client session and a sequence</span>
<span class="sd">    of task IDs.</span>

<span class="sd">    Returns an OrderedDict associating the individual IDs with their</span>
<span class="sd">    resulting taskinfo.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span> <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">results</span>

    <span class="n">fn</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">getTaskInfo</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">iter_bulk_load</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">task_ids</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">err</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">info</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoSuchTask</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span>

    <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="bulk_load_tags"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.bulk_load_tags">[docs]</a><span class="k">def</span> <span class="nf">bulk_load_tags</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param err: Raise an exception if a tag fails to load. Default,</span>
<span class="sd">      True.</span>

<span class="sd">    :type err: bool, optional</span>

<span class="sd">    :param size: Count of tags to load in a single multicall. Default,</span>
<span class="sd">      100</span>

<span class="sd">    :type size: int, optional</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span> <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">results</span>

    <span class="k">if</span> <span class="n">version_check</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">23</span><span class="p">)):</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">getTag</span><span class="p">,</span> <span class="n">blocked</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">getTag</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">iter_bulk_load</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">err</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">info</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoSuchTag</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span>

    <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="bulk_load_rpm_sigs"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.bulk_load_rpm_sigs">[docs]</a><span class="k">def</span> <span class="nf">bulk_load_rpm_sigs</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">rpm_ids</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set up a chunking multicall to fetch the signatures for a list of</span>
<span class="sd">    RPM via session.queryRPMSigs for each ID in rpm_ids.</span>

<span class="sd">    Returns an OrderedDict associating the individual RPM IDs with their</span>
<span class="sd">    resulting RPM signature lists.</span>

<span class="sd">    If results is non-None, it must support a dict-like update method,</span>
<span class="sd">    and will be used in place of a newly allocated OrderedDict to</span>
<span class="sd">    store and return the results.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span> <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">results</span>
    <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">iter_bulk_load</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">session</span><span class="o">.</span><span class="n">queryRPMSigs</span><span class="p">,</span>
                                  <span class="n">rpm_ids</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="bulk_load_buildroot_archives"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.bulk_load_buildroot_archives">[docs]</a><span class="k">def</span> <span class="nf">bulk_load_buildroot_archives</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">buildroot_ids</span><span class="p">,</span> <span class="n">btype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set up a chunking multicall to fetch the archives of buildroots</span>
<span class="sd">    via `session.listArchives` for each buildroot ID in buildrood_ids.</span>

<span class="sd">    Returns an OrderedDict associating the individual buildroot IDs with</span>
<span class="sd">    their resulting archive lists.</span>

<span class="sd">    If results is non-None, it must support dict-like update method,</span>
<span class="sd">    and will be used in place of a newly allocated OrderedDict to</span>
<span class="sd">    store and return the results.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span> <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">results</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">session</span><span class="o">.</span><span class="n">listArchives</span><span class="p">(</span><span class="n">componentBuildrootID</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">btype</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">iter_bulk_load</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">buildroot_ids</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="bulk_load_buildroot_rpms"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.bulk_load_buildroot_rpms">[docs]</a><span class="k">def</span> <span class="nf">bulk_load_buildroot_rpms</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">buildroot_ids</span><span class="p">,</span>
                             <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set up a chunking multicall to fetch the RPMs of buildroots via</span>
<span class="sd">    `session.listRPMs` for each buildroot ID in buildrood_ids.</span>

<span class="sd">    Returns an OrderedDict associating the individual buildroot IDs with</span>
<span class="sd">    their resulting RPM lists.</span>

<span class="sd">    If results is non-None, it must support dict-like update method,</span>
<span class="sd">    and will be used in place of a newly allocated OrderedDict to</span>
<span class="sd">    store and return the results.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span> <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">results</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">session</span><span class="o">.</span><span class="n">listRPMs</span><span class="p">(</span><span class="n">componentBuildrootID</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">iter_bulk_load</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">buildroot_ids</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="bulk_load_build_archives"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.bulk_load_build_archives">[docs]</a><span class="k">def</span> <span class="nf">bulk_load_build_archives</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">build_ids</span><span class="p">,</span> <span class="n">btype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set up a chunking multicall to fetch the archives of builds</span>
<span class="sd">    via `session.listArchives` for each build ID in build_ids.</span>

<span class="sd">    Returns an OrderedDict associating the individual build IDs with</span>
<span class="sd">    their resulting archive lists.</span>

<span class="sd">    If results is non-None, it must support dict-like update method,</span>
<span class="sd">    and will be used in place of a newly allocated OrderedDict to</span>
<span class="sd">    store and return the results.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span> <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">results</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">session</span><span class="o">.</span><span class="n">listArchives</span><span class="p">(</span><span class="n">buildID</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">btype</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">iter_bulk_load</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">build_ids</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="bulk_load_build_rpms"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.bulk_load_build_rpms">[docs]</a><span class="k">def</span> <span class="nf">bulk_load_build_rpms</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">build_ids</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set up a chunking multicall to fetch the RPMs of builds via</span>
<span class="sd">    `session.listRPMS` for each build ID in build_ids.</span>

<span class="sd">    Returns an OrderedDict associating the individual build IDs with</span>
<span class="sd">    their resulting RPM lists.</span>

<span class="sd">    If results is non-None, it must support a dict-like update method,</span>
<span class="sd">    and will be used in place of a newly allocated OrderedDict to</span>
<span class="sd">    store and return the results.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span> <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">results</span>
    <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">iter_bulk_load</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">session</span><span class="o">.</span><span class="n">listRPMs</span><span class="p">,</span>
                                  <span class="n">build_ids</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="bulk_load_buildroots"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.bulk_load_buildroots">[docs]</a><span class="k">def</span> <span class="nf">bulk_load_buildroots</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">broot_ids</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set up a chunking multicall to fetch the buildroot data via</span>
<span class="sd">    session.getBuildroot for each ID in broot_ids.</span>

<span class="sd">    Returns an OrderedDict associating the individual buildroot IDs</span>
<span class="sd">    with their resulting buildroot info dicts.</span>

<span class="sd">    If results is non-None, it must support a dict-like update method,</span>
<span class="sd">    and will be used in place of a newly allocated OrderedDict to</span>
<span class="sd">    store and return the results.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span> <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">results</span>
    <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">iter_bulk_load</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">session</span><span class="o">.</span><span class="n">getBuildroot</span><span class="p">,</span>
                                  <span class="n">broot_ids</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="bulk_load_users"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.bulk_load_users">[docs]</a><span class="k">def</span> <span class="nf">bulk_load_users</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">users</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load many userinfo dicts from a koji client session and a sequence of</span>
<span class="sd">    user identifiers.</span>

<span class="sd">    Returns an OrderedDict associating the individual identifiers with</span>
<span class="sd">    their resulting userinfo.</span>

<span class="sd">    If err is True (default) then any missing user info will raise a</span>
<span class="sd">    NoSuchUser exception. If err is False, then a None will be</span>
<span class="sd">    substituted into the ordered dict for the result.</span>

<span class="sd">    If results is non-None, it must support dict assignment, and will</span>
<span class="sd">    be used in place of a newly allocated OrderedDict to store and</span>
<span class="sd">    return the results.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">users</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span> <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">results</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">users</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="c1"># we need to identify which signature the getUser API will</span>
    <span class="c1"># support.  Unfortunately the change in signatures happened before</span>
    <span class="c1"># there was a way to check the hub version. First we&#39;ll check</span>
    <span class="c1"># whether there&#39;s already a cached answer as to which API is</span>
    <span class="c1"># available</span>
    <span class="n">session_vars</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
    <span class="n">new_get_user</span> <span class="o">=</span> <span class="n">session_vars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;__new_get_user&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">new_get_user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># there wasn&#39;t already an answer, so we&#39;ll have to find out</span>
        <span class="c1"># ourselves. In this case we&#39;ll load the first user in the</span>
        <span class="c1"># list of users separately, outside of a multicall, and using</span>
        <span class="c1"># the as_userinfo function. This function will first try the</span>
        <span class="c1"># newer signature. If successful, it will record</span>
        <span class="c1"># __new_get_user as True, and we&#39;ll know to use the newer</span>
        <span class="c1"># signature. If not, the function will retry with the older</span>
        <span class="c1"># signature and set __new_get_user to False.</span>

        <span class="n">key</span> <span class="o">=</span> <span class="n">users</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">users</span> <span class="o">=</span> <span class="n">users</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">as_userinfo</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NoSuchUser</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># the use of as_userinfo will have updated the __new_get_user</span>
        <span class="c1"># sentinel attribute to either True or False</span>
        <span class="n">new_get_user</span> <span class="o">=</span> <span class="n">session_vars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;__new_get_user&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">new_get_user</span><span class="p">:</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="n">session</span><span class="o">.</span><span class="n">getUser</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">getUser</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">iter_bulk_load</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">users</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">err</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">info</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoSuchUser</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span>

    <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="as_buildinfo"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.as_buildinfo">[docs]</a><span class="k">def</span> <span class="nf">as_buildinfo</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">build</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Coerces a build value into a koji build info dict.</span>

<span class="sd">    If build is an</span>
<span class="sd">     * int, will attempt to load as a build ID</span>
<span class="sd">     * str, will attempt to load as an NVR</span>
<span class="sd">     * dict, will presume already a build info</span>

<span class="sd">    :param build: value to lookup</span>

<span class="sd">    :type build: int or str or dict</span>

<span class="sd">    :raises NoSuchBuild: if the build value could not be resolved</span>
<span class="sd">      into a build info dict</span>

<span class="sd">    :rtype: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">build</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">getBuild</span><span class="p">(</span><span class="n">build</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">build</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">build</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">info</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoSuchBuild</span><span class="p">(</span><span class="n">build</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">info</span></div>


<div class="viewcode-block" id="as_taginfo"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.as_taginfo">[docs]</a><span class="k">def</span> <span class="nf">as_taginfo</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Coerces a tag value into a koji tag info dict.</span>

<span class="sd">    If tag is an</span>
<span class="sd">     * int, will attempt to load as a tag ID</span>
<span class="sd">     * str, will attempt to load as a tag name</span>
<span class="sd">     * dict, will presume already a tag info</span>

<span class="sd">    :param tag: value to lookup</span>

<span class="sd">    :type tag: int or str or dict</span>

<span class="sd">    :param blocked: attempts to load blocked tag extra values. Default,</span>
<span class="sd">      only loads</span>

<span class="sd">    :type blocked: bool, optional</span>

<span class="sd">    :raises NoSuchTag: if the tag value could not be resolved into a</span>
<span class="sd">      tag info dict</span>

<span class="sd">    :rtype: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">version_check</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">23</span><span class="p">)):</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">blocked</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">tag</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">info</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoSuchTag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">info</span></div>


<div class="viewcode-block" id="as_taskinfo"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.as_taskinfo">[docs]</a><span class="k">def</span> <span class="nf">as_taskinfo</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Coerces a task value into a koji task info dict.</span>

<span class="sd">    If task is an</span>
<span class="sd">     * int, will attempt to load as a task ID</span>
<span class="sd">     * dict, will presume already a task info</span>

<span class="sd">    :param task: value to lookup</span>

<span class="sd">    :type task: int or dict</span>

<span class="sd">    :raises NoSuchTask: if the task value could not be resolved</span>
<span class="sd">      into a task info dict</span>

<span class="sd">    :rtype: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">getTaskInfo</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">task</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">info</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoSuchTask</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">info</span></div>


<div class="viewcode-block" id="as_targetinfo"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.as_targetinfo">[docs]</a><span class="k">def</span> <span class="nf">as_targetinfo</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Coerces a target value into a koji target info dict.</span>

<span class="sd">    If target is an</span>
<span class="sd">     * int, will attempt to load as a target ID</span>
<span class="sd">     * str, will attempt to load as a target name</span>
<span class="sd">     * dict, will presume already a target info</span>

<span class="sd">    :param target: value to lookup</span>

<span class="sd">    :type target: int or str or dict</span>

<span class="sd">    :raises NoSuchTarget: if the target value could not be resolved</span>
<span class="sd">      into a target info dict</span>

<span class="sd">    :rtype: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">getBuildTarget</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">target</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">info</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoSuchTarget</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">info</span></div>


<div class="viewcode-block" id="as_hostinfo"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.as_hostinfo">[docs]</a><span class="k">def</span> <span class="nf">as_hostinfo</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">host</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Coerces a host value into a host info dict.</span>

<span class="sd">    If target is an:</span>
<span class="sd">     * int, will attempt to load as a host ID</span>
<span class="sd">     * str, will attempt to load as a host name</span>
<span class="sd">     * dict, will presume already a host info</span>

<span class="sd">    :param host: value to lookup</span>

<span class="sd">    :type host: int or str or dict</span>

<span class="sd">    :raises NoSuchHost: if the host value could not be resolved</span>
<span class="sd">      into a host info dict</span>

<span class="sd">    :rtype: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">getHost</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">host</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">info</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoSuchHost</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">info</span></div>


<div class="viewcode-block" id="as_archiveinfo"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.as_archiveinfo">[docs]</a><span class="k">def</span> <span class="nf">as_archiveinfo</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">archive</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Coerces an archive value into an archive info dict.</span>

<span class="sd">    If archive is an:</span>
<span class="sd">     * int, will attempt to load as an archive ID</span>
<span class="sd">     * str, will attempt to load as an archive filename</span>
<span class="sd">     * dict, will presume already an archive info</span>

<span class="sd">    :param archive: value to lookup</span>

<span class="sd">    :type archive: int or str or dict</span>

<span class="sd">    :raises NoSuchArchive: if the archive value could not be resolved</span>
<span class="sd">      into an archive info dict</span>

<span class="sd">    :rtype dict:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">archive</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">getArchive</span><span class="p">(</span><span class="n">archive</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">archive</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">found</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">listArchives</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">archive</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">found</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">found</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">archive</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">archive</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">info</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoSuchArchive</span><span class="p">(</span><span class="n">archive</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">info</span></div>


<div class="viewcode-block" id="as_rpminfo"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.as_rpminfo">[docs]</a><span class="k">def</span> <span class="nf">as_rpminfo</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">rpm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Coerces a host value into a RPM info dict.</span>

<span class="sd">    If rpm is an:</span>
<span class="sd">     * int, will attempt to load as a RPM ID</span>
<span class="sd">     * str, will attempt to load as a RPM NVR</span>
<span class="sd">     * dict, will presume already an RPM info</span>

<span class="sd">    :param rpm: value to lookup</span>

<span class="sd">    :type rpm: int or str or dict</span>

<span class="sd">    :raises NoSuchRPM: if the rpm value could not be resolved</span>
<span class="sd">      into a RPM info dict</span>

<span class="sd">    :rtype: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rpm</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">getRPM</span><span class="p">(</span><span class="n">rpm</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rpm</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">rpm</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">info</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoSuchRPM</span><span class="p">(</span><span class="n">rpm</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">info</span></div>


<div class="viewcode-block" id="as_userinfo"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.as_userinfo">[docs]</a><span class="k">def</span> <span class="nf">as_userinfo</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resolves user to a userinfo dict.</span>

<span class="sd">    If user is a str or int, then getUser will be invoked. If user is</span>
<span class="sd">    already a dict, it&#39;s presumed to be a userinfo already and it&#39;s</span>
<span class="sd">    returned unaltered.</span>

<span class="sd">    :param user: Name, ID, or User Info describing a koji user</span>

<span class="sd">    :type user: str or int or dict</span>

<span class="sd">    :rtype: dict</span>

<span class="sd">    :raises NoSuchUser: when user cannot be found</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
        <span class="n">session_vars</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
        <span class="n">new_get_user</span> <span class="o">=</span> <span class="n">session_vars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;__new_get_user&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">new_get_user</span><span class="p">:</span>
            <span class="c1"># we&#39;ve tried the new way and it worked, so keep doing it.</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">getUser</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">new_get_user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># an API incompatibility emerged at some point in Koji&#39;s</span>
            <span class="c1"># past, so we need to try the new way first and fall back</span>
            <span class="c1"># to the older signature if that fails. This happened</span>
            <span class="c1"># before Koji hub started reporting its version, so we</span>
            <span class="c1"># cannot use the version_check function to gate this.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">getUser</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="n">session_vars</span><span class="p">[</span><span class="s2">&quot;__new_get_user&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">except</span> <span class="n">ParameterError</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">getUser</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
                <span class="n">session_vars</span><span class="p">[</span><span class="s2">&quot;__new_get_user&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># we&#39;ve already tried the new way once and it didn&#39;t work.</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">getUser</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">user</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">info</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoSuchUser</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">info</span></div>


<span class="k">def</span> <span class="nf">_int</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">val</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">val</span>


<div class="viewcode-block" id="hub_version"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.hub_version">[docs]</a><span class="k">def</span> <span class="nf">hub_version</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper for ``session.getKojiVersion`` which caches the results on</span>
<span class="sd">    the session and splits the value into a tuple of ints for easy</span>
<span class="sd">    comparison.</span>

<span class="sd">    If the getKojiVersion method isn&#39;t implemented on the hub, we</span>
<span class="sd">    presume that we&#39;re version 1.22 ``(1, 22)`` which is the last</span>
<span class="sd">    version before getKojiVersion was added.</span>

<span class="sd">    :rtype: tuple[int]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># we need to use this instead of getattr as koji sessions will</span>
    <span class="c1"># automatically create all missing properties as proxies to a</span>
    <span class="c1"># remote hub method.</span>
    <span class="n">session_vars</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>

    <span class="n">hub_ver</span> <span class="o">=</span> <span class="n">session_vars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;__hub_version&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">hub_ver</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">hub_ver</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">getKojiVersion</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">GenericError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="n">hub_ver</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hub_ver</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hub_ver</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">hub_ver</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">_int</span><span class="p">,</span> <span class="n">hub_ver</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)))</span>

        <span class="n">session_vars</span><span class="p">[</span><span class="s2">&quot;__hub_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hub_ver</span>

    <span class="k">return</span> <span class="n">hub_ver</span></div>


<div class="viewcode-block" id="version_check"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.version_check">[docs]</a><span class="k">def</span> <span class="nf">version_check</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">23</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Verifies that the requested minimum version is met compared</span>
<span class="sd">    against session.getKojiVersion.</span>

<span class="sd">    If the getKojiVersion method isn&#39;t implemented on the hub, we</span>
<span class="sd">    presume that we&#39;re version 1.22 (the last version before</span>
<span class="sd">    getKojiVersion was added). Because of this, checking for minimum</span>
<span class="sd">    versions lower than 1.23 will always return True.</span>

<span class="sd">    Version is specified as a tuple of integers, eg. 1.23 is ``(1,</span>
<span class="sd">    23)``</span>

<span class="sd">    :param minimum: Minimum version required. Default, ``(1, 23)``</span>

<span class="sd">    :type minimum: tuple[int]</span>

<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">minimum</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">_int</span><span class="p">,</span> <span class="n">minimum</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)))</span>

    <span class="n">hub_ver</span> <span class="o">=</span> <span class="n">hub_version</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">hub_ver</span> <span class="ow">and</span> <span class="n">hub_ver</span> <span class="o">&gt;=</span> <span class="n">minimum</span><span class="p">)</span></div>


<div class="viewcode-block" id="version_require"><a class="viewcode-back" href="../../kojismokydingo/#kojismokydingo.version_require">[docs]</a><span class="k">def</span> <span class="nf">version_require</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">23</span><span class="p">),</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Verifies that the requested minimum version is met compared</span>
<span class="sd">    against ``session.getKojiVersion()``</span>

<span class="sd">    If the getKojiVersion method isn&#39;t implemented on the hub, we</span>
<span class="sd">    presume that we&#39;re version 1.22 (the last version before</span>
<span class="sd">    getKojiVersion was added). Because of this, checking for minimum</span>
<span class="sd">    versions lower than 1.23 will always return True.</span>

<span class="sd">    Version is specified as a tuple of integers, eg. 1.23 is ``(1,</span>
<span class="sd">    23)``</span>

<span class="sd">    If the version requirement is not met, a `FeatureUnavailable`</span>
<span class="sd">    exception is raised, with the given message. If message is not</span>
<span class="sd">    provided, a simple one is constructed based on the minimum value.</span>

<span class="sd">    :param minimum: Minimum version required. Default, ``(1, 23)``</span>

<span class="sd">    :type minimum: tuple[int]</span>

<span class="sd">    :param message: Message to use in exception if version check</span>
<span class="sd">      fails. Default, with a minimum of ``(1, 23)``, ``&quot;requires &gt;=</span>
<span class="sd">      1.23&quot;``</span>

<span class="sd">    :type message: str, optional</span>

<span class="sd">    :raises FeatureUnavailable: If the minimum version is not met</span>

<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">version_check</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="n">minimum</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">message</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">minimum</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">minimum</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">minimum</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;requires &gt;= </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">minimum</span>

    <span class="k">raise</span> <span class="n">FeatureUnavailable</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


<span class="c1">#</span>
<span class="c1"># The end.</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">kojismokydingo 0.9.7 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Christopher O&#39;Brien.
      Last updated on 2021-03-10.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.2.
    </div>
  </body>
</html>