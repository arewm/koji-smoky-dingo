
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="English">
  <head>
    <meta charset="utf-8" />
    <title>kojismokydingo.cli.tags &#8212; kojismokydingo 0.9.5 documentation</title>
    <link rel="stylesheet" href="../../../../_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../../genindex/" />
    <link rel="search" title="Search" href="../../../../search/" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../../../../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head><body>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../">kojismokydingo 0.9.5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../" >kojismokydingo</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../" accesskey="U">kojismokydingo.cli</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for kojismokydingo.cli.tags</h1><div class="highlight"><pre>
<span></span><span class="c1"># This library is free software; you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation; either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This library is distributed in the hope that it will be useful, but</span>
<span class="c1"># WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<span class="c1"># General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this library; if not, see &lt;http://www.gnu.org/licenses/&gt;.</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Koji Smoky Dingo - CLI Tag and Target Commands</span>

<span class="sd">:author: Christopher O&#39;Brien &lt;obriencj@gmail.com&gt;</span>
<span class="sd">:license: GPL v3</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">json</span> <span class="k">import</span> <span class="n">dumps</span>
<span class="kn">from</span> <span class="nn">koji_cli.lib</span> <span class="k">import</span> <span class="n">arg_filter</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="k">import</span> <span class="n">itemgetter</span>
<span class="kn">from</span> <span class="nn">six</span> <span class="k">import</span> <span class="n">iteritems</span><span class="p">,</span> <span class="n">itervalues</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="k">import</span> <span class="nb">zip</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">AnonSmokyDingo</span><span class="p">,</span> <span class="n">TagSmokyDingo</span><span class="p">,</span>
    <span class="n">printerr</span><span class="p">,</span> <span class="n">pretty_json</span><span class="p">,</span> <span class="n">tabulate</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">BadDingo</span><span class="p">,</span> <span class="n">FeatureUnavailable</span><span class="p">,</span> <span class="n">NoSuchTag</span><span class="p">,</span> <span class="n">version_require</span>
<span class="kn">from</span> <span class="nn">..tags</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">collect_tag_extras</span><span class="p">,</span> <span class="n">find_inheritance_parent</span><span class="p">,</span> <span class="n">gather_affected_targets</span><span class="p">,</span>
    <span class="n">renum_inheritance</span><span class="p">,</span> <span class="n">resolve_tag</span><span class="p">)</span>


<div class="viewcode-block" id="BadSwap"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.BadSwap">[docs]</a><span class="k">class</span> <span class="nc">BadSwap</span><span class="p">(</span><span class="n">BadDingo</span><span class="p">):</span>
    <span class="n">complaint</span> <span class="o">=</span> <span class="s2">&quot;Wonky inheritance swap requested&quot;</span></div>


<div class="viewcode-block" id="NoSuchInheritance"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.NoSuchInheritance">[docs]</a><span class="k">class</span> <span class="nc">NoSuchInheritance</span><span class="p">(</span><span class="n">BadDingo</span><span class="p">):</span>
    <span class="n">complaint</span> <span class="o">=</span> <span class="s2">&quot;No such inheritance link&quot;</span></div>


<div class="viewcode-block" id="NoSuchTagExtra"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.NoSuchTagExtra">[docs]</a><span class="k">class</span> <span class="nc">NoSuchTagExtra</span><span class="p">(</span><span class="n">BadDingo</span><span class="p">):</span>
    <span class="n">complaint</span> <span class="o">=</span> <span class="s2">&quot;Extra setting is not defined at this tag&quot;</span></div>


<div class="viewcode-block" id="NoSuchMacro"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.NoSuchMacro">[docs]</a><span class="k">class</span> <span class="nc">NoSuchMacro</span><span class="p">(</span><span class="n">NoSuchTagExtra</span><span class="p">):</span>
    <span class="n">complaint</span> <span class="o">=</span> <span class="s2">&quot;Macro is not defined at this tag&quot;</span></div>


<div class="viewcode-block" id="NoSuchEnvVar"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.NoSuchEnvVar">[docs]</a><span class="k">class</span> <span class="nc">NoSuchEnvVar</span><span class="p">(</span><span class="n">NoSuchTagExtra</span><span class="p">):</span>
    <span class="n">complaint</span> <span class="o">=</span> <span class="s2">&quot;Environment variable is not defined at this tag&quot;</span></div>


<div class="viewcode-block" id="cli_affected_targets"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.cli_affected_targets">[docs]</a><span class="k">def</span> <span class="nf">cli_affected_targets</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">tag_list</span><span class="p">,</span>
                         <span class="n">build_tags</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">quiet</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">quiet</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">quiet</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">isatty</span><span class="p">()</span>

    <span class="n">targets</span> <span class="o">=</span> <span class="n">gather_affected_targets</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">tag_list</span><span class="p">)</span>

    <span class="n">debug</span> <span class="o">=</span> <span class="n">printerr</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span> <span class="k">else</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">m</span><span class="p">:</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">info</span><span class="p">:</span>
        <span class="c1"># convert the targets into info tuples</span>
        <span class="n">infos</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">((</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;build_tag_name&#39;</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;dest_tag_name&#39;</span><span class="p">])</span>
                       <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">infos</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># get a unique sorted list of either the target names or the</span>
        <span class="c1"># build tag names for the targets</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="s1">&#39;build_tag_name&#39;</span> <span class="k">if</span> <span class="n">build_tags</span> <span class="k">else</span> <span class="s1">&#39;name&#39;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">targ</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="k">for</span> <span class="n">targ</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">build_tags</span><span class="p">:</span>
        <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Found </span><span class="si">%i</span><span class="s2"> affected build tags inheriting:&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Found </span><span class="si">%i</span><span class="s2"> affected targets inheriting:&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>

    <span class="c1"># for debugging we re-print the tags we operated on</span>
    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">tag_list</span><span class="p">)):</span>
        <span class="n">debug</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">o</span><span class="p">)</span></div>


<div class="viewcode-block" id="AffectedTargets"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.AffectedTargets">[docs]</a><span class="k">class</span> <span class="nc">AffectedTargets</span><span class="p">(</span><span class="n">AnonSmokyDingo</span><span class="p">):</span>

    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Show targets impacted by changes to the given tag(s)&quot;</span>


<div class="viewcode-block" id="AffectedTargets.arguments"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.AffectedTargets.arguments">[docs]</a>    <span class="k">def</span> <span class="nf">arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="n">addarg</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;TAGNAME&quot;</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Tag to check&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;-q&quot;</span><span class="p">,</span> <span class="s2">&quot;--quiet&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Don&#39;t print summary information&quot;</span><span class="p">)</span>

        <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_mutually_exclusive_group</span><span class="p">()</span>
        <span class="n">addarg</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;-i&quot;</span><span class="p">,</span> <span class="s2">&quot;--info&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print target name, build tag name, dest tag name&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">,</span> <span class="s2">&quot;--build-tags&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print build tag names rather than target names&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">parser</span></div>


<div class="viewcode-block" id="AffectedTargets.handle"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.AffectedTargets.handle">[docs]</a>    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cli_affected_targets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">tags</span><span class="p">,</span>
                                    <span class="n">options</span><span class="o">.</span><span class="n">build_tags</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">info</span><span class="p">,</span>
                                    <span class="n">options</span><span class="o">.</span><span class="n">quiet</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="cli_renum_tag"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.cli_renum_tag">[docs]</a><span class="k">def</span> <span class="nf">cli_renum_tag</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">tagname</span><span class="p">,</span> <span class="n">begin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                  <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">session</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="n">tagname</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">NoSuchTag</span><span class="p">(</span><span class="n">tagname</span><span class="p">)</span>

    <span class="n">original</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">getInheritanceData</span><span class="p">(</span><span class="n">tagname</span><span class="p">)</span>
    <span class="n">renumbered</span> <span class="o">=</span> <span class="n">renum_inheritance</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">begin</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">test</span> <span class="ow">or</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Renumbering inheritance priorities for&quot;</span><span class="p">,</span> <span class="n">tagname</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">renumbered</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">lp</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="s1">&#39;priority&#39;</span><span class="p">]</span>
            <span class="n">rp</span> <span class="o">=</span> <span class="n">right</span><span class="p">[</span><span class="s1">&#39;priority&#39;</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">%3i</span><span class="s2"> -&gt; </span><span class="si">%3i</span><span class="s2">  </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lp</span><span class="p">,</span> <span class="n">rp</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">test</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Changes not committed in test mode.&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">setInheritanceData</span><span class="p">(</span><span class="n">tagname</span><span class="p">,</span> <span class="n">renumbered</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">results</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span></div>


<div class="viewcode-block" id="RenumTagInheritance"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.RenumTagInheritance">[docs]</a><span class="k">class</span> <span class="nc">RenumTagInheritance</span><span class="p">(</span><span class="n">TagSmokyDingo</span><span class="p">):</span>

    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Renumbers inheritance priorities of a tag,&quot;</span> \
                  <span class="s2">&quot; preserving order&quot;</span>


<div class="viewcode-block" id="RenumTagInheritance.arguments"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.RenumTagInheritance.arguments">[docs]</a>    <span class="k">def</span> <span class="nf">arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="n">addarg</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;TAGNAME&quot;</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Tag to renumber&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--verbose&quot;</span><span class="p">,</span> <span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print information about what&#39;s changing&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--test&quot;</span><span class="p">,</span> <span class="s2">&quot;-t&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Calculate the new priorities, but don&#39;t commit&quot;</span>
               <span class="s2">&quot; the changes&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--begin&quot;</span><span class="p">,</span> <span class="s2">&quot;-b&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;New priority for first inheritance link&quot;</span>
               <span class="s2">&quot; (default: 10)&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--step&quot;</span><span class="p">,</span> <span class="s2">&quot;-s&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Priority increment for each subsequent&quot;</span>
               <span class="s2">&quot; inheritance link after the first (default: 10)&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">parser</span></div>


<div class="viewcode-block" id="RenumTagInheritance.validate"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.RenumTagInheritance.validate">[docs]</a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="n">begin</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">begin</span>
        <span class="k">if</span> <span class="n">begin</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;begin value must not be negative&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">begin</span> <span class="o">&gt;=</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;don&#39;t be ridiculous&quot;</span><span class="p">)</span>

        <span class="n">step</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">step</span>
        <span class="k">if</span> <span class="n">step</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;priority increment must be positive&quot;</span>
                         <span class="s2">&quot; (no reversing)&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">step</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;don&#39;t be ridiculous&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="RenumTagInheritance.handle"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.RenumTagInheritance.handle">[docs]</a>    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cli_renum_tag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                             <span class="n">options</span><span class="o">.</span><span class="n">begin</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">step</span><span class="p">,</span>
                             <span class="n">options</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">test</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="cli_swap_inheritance"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.cli_swap_inheritance">[docs]</a><span class="k">def</span> <span class="nf">cli_swap_inheritance</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">tagname</span><span class="p">,</span> <span class="n">old_parent</span><span class="p">,</span> <span class="n">new_parent</span><span class="p">,</span>
                         <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">tagname</span> <span class="ow">in</span> <span class="p">(</span><span class="n">old_parent</span><span class="p">,</span> <span class="n">new_parent</span><span class="p">)</span> <span class="ow">or</span> <span class="n">old_parent</span> <span class="o">==</span> <span class="n">new_parent</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">BadSwap</span><span class="p">(</span><span class="n">tagname</span><span class="p">,</span> <span class="n">old_parent</span><span class="p">,</span> <span class="n">new_parent</span><span class="p">)</span>

    <span class="n">original</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">getInheritanceData</span><span class="p">(</span><span class="n">tagname</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">original</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoSuchTag</span><span class="p">(</span><span class="n">tagname</span><span class="p">)</span>

    <span class="n">old_p</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="n">old_parent</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">old_p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoSuchTag</span><span class="p">(</span><span class="n">old_parent</span><span class="p">)</span>

    <span class="n">new_p</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="n">new_parent</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">new_p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoSuchTag</span><span class="p">(</span><span class="n">new_parent</span><span class="p">)</span>

    <span class="c1"># deep copy of original inheritance</span>
    <span class="n">swapped</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">original</span><span class="p">]</span>

    <span class="n">found_old</span> <span class="o">=</span> <span class="n">find_inheritance_parent</span><span class="p">(</span><span class="n">swapped</span><span class="p">,</span> <span class="n">old_p</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
    <span class="n">found_new</span> <span class="o">=</span> <span class="n">find_inheritance_parent</span><span class="p">(</span><span class="n">swapped</span><span class="p">,</span> <span class="n">new_p</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">found_old</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NoSuchInheritance</span><span class="p">(</span><span class="n">tagname</span><span class="p">,</span> <span class="n">old_parent</span><span class="p">)</span>

    <span class="c1"># this looks convoluted, because we&#39;re doing two things at</span>
    <span class="c1"># once. First, we&#39;re duplicating the whole inheritance structure</span>
    <span class="c1"># so we can show what&#39;s changed. Second, we&#39;re collecting the</span>
    <span class="c1"># changes as either two edits, or a delete and an addition.</span>

    <span class="k">if</span> <span class="n">found_new</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># the new inheritance isn&#39;t in the current inheritance</span>
        <span class="c1"># structure, therefore duplicate the old inheritance link and</span>
        <span class="c1"># mark it as a deletion, and then modify the old inheritance</span>
        <span class="c1"># link later.</span>
        <span class="n">changed_old</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">found_old</span><span class="p">)</span>
        <span class="n">changed_old</span><span class="p">[</span><span class="s1">&#39;delete link&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">changes</span> <span class="o">=</span> <span class="p">[</span><span class="n">changed_old</span><span class="p">,</span> <span class="n">found_old</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># the new inheritance link is also within the current</span>
        <span class="c1"># inheritance structure, therefore this is an action to make</span>
        <span class="c1"># two edits. Mix in the updated new inheritance data now, and</span>
        <span class="c1"># the old inheritance link will be updated at the end.</span>
        <span class="n">changes</span> <span class="o">=</span> <span class="p">[</span><span class="n">found_old</span><span class="p">,</span> <span class="n">found_new</span><span class="p">]</span>
        <span class="n">found_new</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_p</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="n">found_new</span><span class="p">[</span><span class="s2">&quot;parent_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_p</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>

    <span class="c1"># we do this last so that we&#39;ll have a chance to duplicate the</span>
    <span class="c1"># original if needed</span>
    <span class="n">found_old</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_p</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
    <span class="n">found_old</span><span class="p">[</span><span class="s2">&quot;parent_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_p</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>

    <span class="c1"># at this point the swapped list represents the fully modified</span>
    <span class="c1"># inheritance structure we&#39;d like to see, and changes represents</span>
    <span class="c1"># just the two edits we&#39;re making.</span>

    <span class="k">if</span> <span class="n">test</span> <span class="ow">or</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Swapping inheritance data for&quot;</span><span class="p">,</span> <span class="n">tagname</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">swapped</span><span class="p">):</span>
            <span class="n">priority</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="s1">&#39;priority&#39;</span><span class="p">]</span>
            <span class="n">lp</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">rp</span> <span class="o">=</span> <span class="n">right</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">lp</span> <span class="o">!=</span> <span class="n">rp</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">%3i</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> -&gt; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">priority</span><span class="p">,</span> <span class="n">lp</span><span class="p">,</span> <span class="n">rp</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">%3i</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">priority</span><span class="p">,</span> <span class="n">lp</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">test</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Changes not committed in test mode.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">setInheritanceData</span><span class="p">(</span><span class="n">tagname</span><span class="p">,</span> <span class="n">changes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">results</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span></div>


<div class="viewcode-block" id="SwapTagInheritance"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.SwapTagInheritance">[docs]</a><span class="k">class</span> <span class="nc">SwapTagInheritance</span><span class="p">(</span><span class="n">TagSmokyDingo</span><span class="p">):</span>

    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Swap a tag&#39;s inheritance&quot;</span>


<div class="viewcode-block" id="SwapTagInheritance.arguments"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.SwapTagInheritance.arguments">[docs]</a>    <span class="k">def</span> <span class="nf">arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="n">addarg</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;TAGNAME&quot;</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Name of tag to modify&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;old_parent&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;OLD_PARENT_TAG&quot;</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Old parent tag&#39;s name&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;new_parent&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;NEW_PARENT_TAG&quot;</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;New parent tag&#39;s name&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--verbose&quot;</span><span class="p">,</span> <span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print information about what&#39;s changing&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--test&quot;</span><span class="p">,</span> <span class="s2">&quot;-t&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Calculate the new inheritance, but don&#39;t commit&quot;</span>
               <span class="s2">&quot; the changes.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">parser</span></div>


<div class="viewcode-block" id="SwapTagInheritance.handle"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.SwapTagInheritance.handle">[docs]</a>    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cli_swap_inheritance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                                    <span class="n">options</span><span class="o">.</span><span class="n">old_parent</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">new_parent</span><span class="p">,</span>
                                    <span class="n">options</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">test</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="cli_list_rpm_macros"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.cli_list_rpm_macros">[docs]</a><span class="k">def</span> <span class="nf">cli_list_rpm_macros</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">tagname</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">quiet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">defn</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="n">taginfo</span> <span class="o">=</span> <span class="n">resolve_tag</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">tagname</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

    <span class="n">extras</span> <span class="o">=</span> <span class="n">collect_tag_extras</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">taginfo</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;rpm.macro.&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">extra</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">extras</span><span class="p">):</span>
        <span class="n">extra</span><span class="p">[</span><span class="s2">&quot;macro&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="mi">10</span><span class="p">:]</span>

    <span class="k">if</span> <span class="n">json</span><span class="p">:</span>
        <span class="n">pretty_json</span><span class="p">(</span><span class="n">extras</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">defn</span><span class="p">:</span>
        <span class="c1"># macro definition mode</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;%</span><span class="si">{macro}</span><span class="s2"> </span><span class="si">{value}</span><span class="s2">&quot;</span>

        <span class="k">for</span> <span class="n">extra</span> <span class="ow">in</span> <span class="n">itervalues</span><span class="p">(</span><span class="n">extras</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">extra</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">tabulate</span><span class="p">((</span><span class="s2">&quot;Macro&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="s2">&quot;Tag&quot;</span><span class="p">),</span>
                 <span class="n">itervalues</span><span class="p">(</span><span class="n">extras</span><span class="p">),</span>
                 <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="s2">&quot;macro&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;tag_name&quot;</span><span class="p">),</span>
                 <span class="n">sorting</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">quiet</span><span class="o">=</span><span class="n">quiet</span><span class="p">)</span></div>


<div class="viewcode-block" id="ListRPMMacros"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.ListRPMMacros">[docs]</a><span class="k">class</span> <span class="nc">ListRPMMacros</span><span class="p">(</span><span class="n">AnonSmokyDingo</span><span class="p">):</span>

    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Show RPM Macros for a tag&quot;</span>


<div class="viewcode-block" id="ListRPMMacros.arguments"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.ListRPMMacros.arguments">[docs]</a>    <span class="k">def</span> <span class="nf">arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="n">addarg</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;TAGNAME&quot;</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Name of tag&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--target&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Specify by target rather than a tag&quot;</span><span class="p">)</span>

        <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_mutually_exclusive_group</span><span class="p">()</span>
        <span class="n">addarg</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--quiet&quot;</span><span class="p">,</span> <span class="s2">&quot;-q&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Omit headings&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--macro-definition&quot;</span><span class="p">,</span> <span class="s2">&quot;-d&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
               <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;defn&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output as RPM macro definitions&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--json&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output as JSON&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">parser</span></div>


<div class="viewcode-block" id="ListRPMMacros.handle"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.ListRPMMacros.handle">[docs]</a>    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cli_list_rpm_macros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                                   <span class="n">target</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">target</span><span class="p">,</span>
                                   <span class="n">quiet</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">quiet</span><span class="p">,</span>
                                   <span class="n">defn</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">defn</span><span class="p">,</span>
                                   <span class="n">json</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">json</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="cli_set_rpm_macro"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.cli_set_rpm_macro">[docs]</a><span class="k">def</span> <span class="nf">cli_set_rpm_macro</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">tagname</span><span class="p">,</span> <span class="n">macro</span><span class="p">,</span>
                      <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">target</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If remove is True, value and block are ignored. The setting will</span>
<span class="sd">    be removed from the tag&#39;s extra settings.</span>

<span class="sd">    If block is True, value is ignored. A block entry will be added to</span>
<span class="sd">    the tag&#39;s extra settings.</span>

<span class="sd">    If remove and block are both False, then the value will be</span>
<span class="sd">    assigned to the tag&#39;s extra settings.</span>

<span class="sd">    If target is True, then tagname is actually the name of a target.</span>
<span class="sd">    That target&#39;s build tag will be the tag that is therefore</span>
<span class="sd">    modified.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">taginfo</span> <span class="o">=</span> <span class="n">resolve_tag</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">tagname</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">macro</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;rpm.macro.&quot;</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">macro</span>
        <span class="n">macro</span> <span class="o">=</span> <span class="n">macro</span><span class="p">[</span><span class="mi">10</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="n">macro</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">):</span>
        <span class="n">macro</span> <span class="o">=</span> <span class="n">macro</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;rpm.macro.&quot;</span> <span class="o">+</span> <span class="n">macro</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;rpm.macro.&quot;</span> <span class="o">+</span> <span class="n">macro</span>

    <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">taginfo</span><span class="p">[</span><span class="s2">&quot;extra&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">NoSuchMacro</span><span class="p">(</span><span class="n">macro</span><span class="p">)</span>

        <span class="n">session</span><span class="o">.</span><span class="n">editTag2</span><span class="p">(</span><span class="n">taginfo</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">remove_extra</span><span class="o">=</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

    <span class="k">elif</span> <span class="n">block</span><span class="p">:</span>
        <span class="n">version_require</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">23</span><span class="p">),</span> <span class="s2">&quot;block tag extra values&quot;</span><span class="p">)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">editTag2</span><span class="p">(</span><span class="n">taginfo</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">block_extra</span><span class="o">=</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># converts to numbers, True, False, and None as applicable</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">arg_filter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="c1"># an empty string breaks mock and RPM, make it %nil instead.  RPM</span>
        <span class="c1"># macros are not allowed to have an empty body. None is treated as</span>
        <span class="c1"># the string &quot;None&quot; so we leave that alone.</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;%nil&quot;</span>

        <span class="n">session</span><span class="o">.</span><span class="n">editTag2</span><span class="p">(</span><span class="n">taginfo</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span></div>


<div class="viewcode-block" id="SetRPMMacro"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.SetRPMMacro">[docs]</a><span class="k">class</span> <span class="nc">SetRPMMacro</span><span class="p">(</span><span class="n">TagSmokyDingo</span><span class="p">):</span>

    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Set an RPM Macro on a tag&quot;</span>


<div class="viewcode-block" id="SetRPMMacro.arguments"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.SetRPMMacro.arguments">[docs]</a>    <span class="k">def</span> <span class="nf">arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="n">addarg</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;TAGNAME&quot;</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Name of tag&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;macro&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Name of the macro&quot;</span><span class="p">)</span>

        <span class="n">grp</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_mutually_exclusive_group</span><span class="p">()</span>
        <span class="n">addarg</span> <span class="o">=</span> <span class="n">grp</span><span class="o">.</span><span class="n">add_argument</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;%nil&quot;</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Value of the macro. Default: </span><span class="si">%%</span><span class="s2">nil&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--remove&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Remove the macro definition from the tag&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--block&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Block the macro definition from the tag&quot;</span><span class="p">)</span>

        <span class="n">addarg</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--target&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Specify by target rather than a tag&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">parser</span></div>


<div class="viewcode-block" id="SetRPMMacro.handle"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.SetRPMMacro.handle">[docs]</a>    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cli_set_rpm_macro</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                                 <span class="n">options</span><span class="o">.</span><span class="n">macro</span><span class="p">,</span>
                                 <span class="n">value</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                 <span class="n">remove</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">remove</span><span class="p">,</span>
                                 <span class="n">block</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">block</span><span class="p">,</span>
                                 <span class="n">target</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">target</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="RemoveRPMMacro"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.RemoveRPMMacro">[docs]</a><span class="k">class</span> <span class="nc">RemoveRPMMacro</span><span class="p">(</span><span class="n">TagSmokyDingo</span><span class="p">):</span>

    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Remove an RPM Macro from a tag&quot;</span>


<div class="viewcode-block" id="RemoveRPMMacro.arguments"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.RemoveRPMMacro.arguments">[docs]</a>    <span class="k">def</span> <span class="nf">arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="n">addarg</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;TAGNAME&quot;</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Name of tag&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;macro&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Name of the macro to remove&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--target&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Specify by target rather than a tag&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">parser</span></div>


<div class="viewcode-block" id="RemoveRPMMacro.handle"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.RemoveRPMMacro.handle">[docs]</a>    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cli_set_rpm_macro</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                                 <span class="n">options</span><span class="o">.</span><span class="n">macro</span><span class="p">,</span>
                                 <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                 <span class="n">target</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">target</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="BlockRPMMacro"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.BlockRPMMacro">[docs]</a><span class="k">class</span> <span class="nc">BlockRPMMacro</span><span class="p">(</span><span class="n">TagSmokyDingo</span><span class="p">):</span>

    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Block an RPM Macro from a tag&quot;</span>


<div class="viewcode-block" id="BlockRPMMacro.arguments"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.BlockRPMMacro.arguments">[docs]</a>    <span class="k">def</span> <span class="nf">arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="n">addarg</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;TAGNAME&quot;</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Name of tag&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;macro&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Name of the macro to block&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--target&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Specify by target rather than a tag&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">parser</span></div>


<div class="viewcode-block" id="BlockRPMMacro.handle"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.BlockRPMMacro.handle">[docs]</a>    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cli_set_rpm_macro</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                                 <span class="n">options</span><span class="o">.</span><span class="n">macro</span><span class="p">,</span>
                                 <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="n">remove</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                 <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="n">target</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">target</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="cli_set_env_var"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.cli_set_env_var">[docs]</a><span class="k">def</span> <span class="nf">cli_set_env_var</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">tagname</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span>
                    <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">target</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If remove is True, value and block are ignored. The setting will</span>
<span class="sd">    be removed from the tag&#39;s extra settings.</span>

<span class="sd">    If block is True, value is ignored. A block entry will be added to</span>
<span class="sd">    the tag&#39;s extra settings.</span>

<span class="sd">    If remove and block are both False, then the value will be</span>
<span class="sd">    assigned to the tag&#39;s extra settings.</span>

<span class="sd">    If target is True, then tagname is actually the name of a target.</span>
<span class="sd">    That target&#39;s build tag will be the tag that is therefore</span>
<span class="sd">    modified.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">taginfo</span> <span class="o">=</span> <span class="n">resolve_tag</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">tagname</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;rpm.env.&quot;</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">var</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">var</span><span class="p">[</span><span class="mi">8</span><span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;rpm.env.&quot;</span> <span class="o">+</span> <span class="n">var</span>

    <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">taginfo</span><span class="p">[</span><span class="s2">&quot;extra&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">NoSuchEnvVar</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>

        <span class="n">session</span><span class="o">.</span><span class="n">editTag2</span><span class="p">(</span><span class="n">taginfo</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">remove_extra</span><span class="o">=</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

    <span class="k">elif</span> <span class="n">block</span><span class="p">:</span>
        <span class="n">version_require</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">23</span><span class="p">),</span> <span class="s2">&quot;block tag extra values&quot;</span><span class="p">)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">editTag2</span><span class="p">(</span><span class="n">taginfo</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">block_extra</span><span class="o">=</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">session</span><span class="o">.</span><span class="n">editTag2</span><span class="p">(</span><span class="n">taginfo</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span></div>


<div class="viewcode-block" id="SetEnvVar"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.SetEnvVar">[docs]</a><span class="k">class</span> <span class="nc">SetEnvVar</span><span class="p">(</span><span class="n">TagSmokyDingo</span><span class="p">):</span>

    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Set a mock environment variable on a tag&quot;</span>


<div class="viewcode-block" id="SetEnvVar.arguments"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.SetEnvVar.arguments">[docs]</a>    <span class="k">def</span> <span class="nf">arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="n">addarg</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;TAGNAME&quot;</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Name of tag&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Name of the environment variable&quot;</span><span class="p">)</span>

        <span class="n">grp</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_mutually_exclusive_group</span><span class="p">()</span>
        <span class="n">addarg</span> <span class="o">=</span> <span class="n">grp</span><span class="o">.</span><span class="n">add_argument</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Value of the environment var. Default: &#39;&#39;&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--remove&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Remove the environment var from the tag&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--block&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Block the environment var from the tag&quot;</span><span class="p">)</span>

        <span class="n">addarg</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--target&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Specify by target rather than a tag&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">parser</span></div>


<div class="viewcode-block" id="SetEnvVar.validate"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.SetEnvVar.validate">[docs]</a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">value</span>

        <span class="k">if</span> <span class="n">val</span> <span class="ow">and</span> <span class="n">val</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\-&quot;</span><span class="p">):</span>
            <span class="c1"># fight against option parsing</span>
            <span class="n">options</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">val</span> <span class="ow">or</span> <span class="n">options</span><span class="o">.</span><span class="n">remove</span> <span class="ow">or</span> <span class="n">options</span><span class="o">.</span><span class="n">block</span><span class="p">):</span>
            <span class="c1"># support KEY=VAL definitions</span>
            <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">var</span><span class="p">:</span>
                <span class="n">var</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">options</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">var</span>
                <span class="n">options</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">val</span></div>


<div class="viewcode-block" id="SetEnvVar.handle"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.SetEnvVar.handle">[docs]</a>    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cli_set_env_var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                               <span class="n">options</span><span class="o">.</span><span class="n">var</span><span class="p">,</span>
                               <span class="n">value</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                               <span class="n">remove</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">remove</span><span class="p">,</span>
                               <span class="n">block</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">block</span><span class="p">,</span>
                               <span class="n">target</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">target</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="RemoveEnvVar"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.RemoveEnvVar">[docs]</a><span class="k">class</span> <span class="nc">RemoveEnvVar</span><span class="p">(</span><span class="n">TagSmokyDingo</span><span class="p">):</span>

    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Remove a mock environment variable from a tag&quot;</span>


<div class="viewcode-block" id="RemoveEnvVar.arguments"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.RemoveEnvVar.arguments">[docs]</a>    <span class="k">def</span> <span class="nf">arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="n">addarg</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;TAGNAME&quot;</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Name of tag&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Name of the environment variable&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--target&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Specify by target rather than a tag&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">parser</span></div>


<div class="viewcode-block" id="RemoveEnvVar.handle"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.RemoveEnvVar.handle">[docs]</a>    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cli_set_env_var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                               <span class="n">options</span><span class="o">.</span><span class="n">var</span><span class="p">,</span>
                               <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                               <span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">target</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">target</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="BlockEnvVar"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.BlockEnvVar">[docs]</a><span class="k">class</span> <span class="nc">BlockEnvVar</span><span class="p">(</span><span class="n">TagSmokyDingo</span><span class="p">):</span>

    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Block a mock environment variable from a tag&quot;</span>


<div class="viewcode-block" id="BlockEnvVar.arguments"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.BlockEnvVar.arguments">[docs]</a>    <span class="k">def</span> <span class="nf">arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="n">addarg</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;TAGNAME&quot;</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Name of tag&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Name of the environment variable&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--target&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Specify by target rather than a tag&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">parser</span></div>


<div class="viewcode-block" id="BlockEnvVar.handle"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.BlockEnvVar.handle">[docs]</a>    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cli_set_env_var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                               <span class="n">options</span><span class="o">.</span><span class="n">var</span><span class="p">,</span>
                               <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                               <span class="n">remove</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">target</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">target</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="cli_list_env_vars"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.cli_list_env_vars">[docs]</a><span class="k">def</span> <span class="nf">cli_list_env_vars</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">tagname</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">quiet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">defn</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="n">taginfo</span> <span class="o">=</span> <span class="n">resolve_tag</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">tagname</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

    <span class="n">extras</span> <span class="o">=</span> <span class="n">collect_tag_extras</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">taginfo</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;rpm.env.&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">extra</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">extras</span><span class="p">):</span>
        <span class="n">extra</span><span class="p">[</span><span class="s2">&quot;var&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="mi">8</span><span class="p">:]</span>

    <span class="k">if</span> <span class="n">json</span><span class="p">:</span>
        <span class="n">pretty_json</span><span class="p">(</span><span class="n">extras</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># we&#39;re going to want to add some escaping safety nets. Let&#39;s</span>
        <span class="c1"># have json.dumps do that work for us.</span>
        <span class="k">for</span> <span class="n">extra</span> <span class="ow">in</span> <span class="n">itervalues</span><span class="p">(</span><span class="n">extras</span><span class="p">):</span>
            <span class="n">extra</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dumps</span><span class="p">(</span><span class="n">extra</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">defn</span><span class="p">:</span>
        <span class="c1"># macro definition mode</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{var!s}</span><span class="s2">=</span><span class="si">{value!s}</span><span class="s2">&quot;</span>

        <span class="k">for</span> <span class="n">extra</span> <span class="ow">in</span> <span class="n">itervalues</span><span class="p">(</span><span class="n">extras</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">extra</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">tabulate</span><span class="p">((</span><span class="s2">&quot;Variable&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="s2">&quot;Tag&quot;</span><span class="p">),</span>
                 <span class="n">itervalues</span><span class="p">(</span><span class="n">extras</span><span class="p">),</span>
                 <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;tag_name&quot;</span><span class="p">),</span>
                 <span class="n">sorting</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">quiet</span><span class="o">=</span><span class="n">quiet</span><span class="p">)</span></div>


<div class="viewcode-block" id="ListEnvVars"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.ListEnvVars">[docs]</a><span class="k">class</span> <span class="nc">ListEnvVars</span><span class="p">(</span><span class="n">AnonSmokyDingo</span><span class="p">):</span>

    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Show mock environment variables for a tag&quot;</span>


<div class="viewcode-block" id="ListEnvVars.arguments"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.ListEnvVars.arguments">[docs]</a>    <span class="k">def</span> <span class="nf">arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="n">addarg</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;TAGNAME&quot;</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Name of tag&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--target&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Specify by target rather than a tag&quot;</span><span class="p">)</span>

        <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_mutually_exclusive_group</span><span class="p">()</span>
        <span class="n">addarg</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--quiet&quot;</span><span class="p">,</span> <span class="s2">&quot;-q&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Omit headings&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--sh-declaration&quot;</span><span class="p">,</span> <span class="s2">&quot;-d&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
               <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;defn&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output as sh variable declarations&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--json&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output as JSON&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">parser</span></div>


<div class="viewcode-block" id="ListEnvVars.handle"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.ListEnvVars.handle">[docs]</a>    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cli_list_env_vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                                 <span class="n">target</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">target</span><span class="p">,</span>
                                 <span class="n">quiet</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">quiet</span><span class="p">,</span>
                                 <span class="n">defn</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">defn</span><span class="p">,</span>
                                 <span class="n">json</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">json</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="cli_list_tag_extras"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.cli_list_tag_extras">[docs]</a><span class="k">def</span> <span class="nf">cli_list_tag_extras</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">tagname</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">blocked</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">quiet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="n">taginfo</span> <span class="o">=</span> <span class="n">resolve_tag</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">tagname</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
    <span class="n">extras</span> <span class="o">=</span> <span class="n">collect_tag_extras</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">taginfo</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">json</span><span class="p">:</span>
        <span class="n">pretty_json</span><span class="p">(</span><span class="n">extras</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">blocked</span><span class="p">:</span>
        <span class="n">headings</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Setting&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="s2">&quot;Tag&quot;</span><span class="p">,</span> <span class="s2">&quot;Block&quot;</span><span class="p">)</span>
        <span class="n">_fields</span> <span class="o">=</span> <span class="n">itemgetter</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;tag_name&quot;</span><span class="p">,</span> <span class="s2">&quot;blocked&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">fields</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_fields</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
            <span class="n">vals</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;[BLOCK]&quot;</span> <span class="k">if</span> <span class="n">vals</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="k">return</span> <span class="n">vals</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">headings</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Setting&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="s2">&quot;Tag&quot;</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">itemgetter</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;tag_name&quot;</span><span class="p">)</span>

    <span class="n">tabulate</span><span class="p">(</span><span class="n">headings</span><span class="p">,</span>
             <span class="n">itervalues</span><span class="p">(</span><span class="n">extras</span><span class="p">),</span>
             <span class="n">key</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
             <span class="n">sorting</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
             <span class="n">quiet</span><span class="o">=</span><span class="n">quiet</span><span class="p">)</span></div>


<div class="viewcode-block" id="ListTagExtras"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.ListTagExtras">[docs]</a><span class="k">class</span> <span class="nc">ListTagExtras</span><span class="p">(</span><span class="n">AnonSmokyDingo</span><span class="p">):</span>

    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Show extra settings for a tag&quot;</span>


<div class="viewcode-block" id="ListTagExtras.arguments"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.ListTagExtras.arguments">[docs]</a>    <span class="k">def</span> <span class="nf">arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="n">addarg</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;tag&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;TAGNAME&quot;</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Name of tag&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--target&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Specify by target rather than a tag&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--blocked&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show blocked extras&quot;</span><span class="p">)</span>

        <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_mutually_exclusive_group</span><span class="p">()</span>
        <span class="n">addarg</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">add_argument</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--quiet&quot;</span><span class="p">,</span> <span class="s2">&quot;-q&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Omit headings&quot;</span><span class="p">)</span>

        <span class="n">addarg</span><span class="p">(</span><span class="s2">&quot;--json&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output as JSON&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">parser</span></div>


<div class="viewcode-block" id="ListTagExtras.handle"><a class="viewcode-back" href="../../../../kojismokydingo/cli/tags/#kojismokydingo.cli.tags.ListTagExtras.handle">[docs]</a>    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cli_list_tag_extras</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                                   <span class="n">target</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">target</span><span class="p">,</span>
                                   <span class="n">blocked</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">blocked</span><span class="p">,</span>
                                   <span class="n">quiet</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">quiet</span><span class="p">,</span>
                                   <span class="n">json</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">json</span><span class="p">)</span></div></div>


<span class="c1">#</span>
<span class="c1"># The end.</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../">kojismokydingo 0.9.5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../" >kojismokydingo</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="../" >kojismokydingo.cli</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Christopher O&#39;Brien.
      Last updated on 2020-12-18.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.
    </div>
  </body>
</html>